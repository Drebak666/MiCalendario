<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calendario</title>
  <style>
    body {
      background-color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .btn-volver {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 120px;
      font-weight: bold;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 50%;
      width: 120px;
      height: 120px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    .btn-volver:hover {
      background-color: #45a049;
    }

    #calendar {
      margin-top: 20px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 40px;
      table-layout: fixed;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      height: 60px;
      text-align: center;
      word-wrap: break-word;
    }

    td:hover {
      background-color: #eee;
      cursor: pointer;
    }

    .selected {
      background-color: #2196F3;
      color: white;
      font-weight: bold;
    }

    .tarea-form {
      margin-top: 30px;
      text-align: center;
      width: 100%;
      max-width: 800px;
    }

    #tareaInput {
      width: 100%;
      padding: 14px;
      font-size: 42px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .btn-guardar {
      padding: 14px 24px;
      font-size: 50px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .btn-guardar:hover {
      background-color: #45a049;
    }

    .tarea-confirmacion {
      color: green;
      margin-top: 10px;
      font-size: 20px;
    }

    .tarea-item {
      background-color: #f0f0f0;
      margin-top: 5px;
      padding: 8px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 50px;
    }

    .tarea-item button {
      background-color: red;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 6px 12px;
      font-size: 50px;
      cursor: pointer;
    }

    .selector-container {
      font-size: 28px;
      margin-top: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .selector-container select,
    .selector-container button {
      font-size: 50px;
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <button class="btn-volver" onclick="location.href='/'" title="Volver">&#8635;</button>

  <div class="selector-container">
    <select id="mes" onchange="cambiarMes()"></select>
    <select id="anio" onchange="cambiarMes()"></select>
    <button onclick="volverMesActual()">Mes actual</button>
  </div>

  <div id="calendar"></div>

  <div class="tarea-form">
    <input type="text" id="tareaInput" placeholder="Escribe tu tarea para el día seleccionado">
    <button class="btn-guardar" onclick="guardarTarea()">Guardar</button>
    <div id="mensajeTarea" class="tarea-confirmacion"></div>
    <div id="listaTareas"></div>
  </div>

  <script>
    let diaSeleccionado = null;
    let anioActual = new Date().getFullYear();
    let mesActual = new Date().getMonth();
    let tareas = JSON.parse(localStorage.getItem('tareas')) || {};


    function generateCalendar(year, month) {
      const calendarDiv = document.getElementById('calendar');
      calendarDiv.innerHTML = '';

      const daysOfWeek = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
      let table = '<table><tr>';
      for (let day of daysOfWeek) {
        table += `<th>${day}</th>`;
      }
      table += '</tr>';

      let firstDay = new Date(year, month, 1).getDay();
      let daysInMonth = new Date(year, month + 1, 0).getDate();

      let dayCount = 1;
      for (let week = 0; week < 6; week++) {
        table += '<tr>';
        for (let day = 0; day < 7; day++) {
          if (week === 0 && day < firstDay) {
            table += '<td></td>';
          } else if (dayCount > daysInMonth) {
            table += '<td></td>';
          } else {
            let today = new Date();
            let isToday = dayCount === today.getDate() && month === today.getMonth() && year === today.getFullYear();

            let key = `${year}-${month + 1}-${dayCount}`;
            let tieneTareas = tareas[key] && tareas[key].length > 0;

            let estilo = '';
            if (isToday) estilo += 'background-color:#4CAF50; color:white; font-weight:bold;';
            if (tieneTareas) estilo += 'border: 4px solid #FF5722;';

            table += `<td onclick="seleccionarDia(${dayCount}, this)" style="${estilo}">${dayCount}</td>`;
            dayCount++;
          }
        }
        table += '</tr>';
        if (dayCount > daysInMonth) break;
      }
      table += '</table>';
      calendarDiv.innerHTML = table;
    }

    function seleccionarDia(dia, celda) {
      diaSeleccionado = dia;
      document.querySelectorAll('td').forEach(td => td.classList.remove('selected'));
      celda.classList.add('selected');
      mostrarTareas();
    }
function guardarEnLocalStorage() {
  localStorage.setItem('tareas', JSON.stringify(tareas));
}


    function guardarTarea() {
      if (!diaSeleccionado) {
        alert("Primero selecciona un día.");
        return;
      }

      let texto = document.getElementById('tareaInput').value.trim();
      if (texto === "") return;

      let key = `${anioActual}-${mesActual + 1}-${diaSeleccionado}`;
      if (!tareas[key]) tareas[key] = [];
      tareas[key].push(texto);
guardarEnLocalStorage();

      document.getElementById('tareaInput').value = "";
      document.getElementById('mensajeTarea').innerText = "Tarea guardada";
      mostrarTareas();
      generateCalendar(anioActual, mesActual);

      setTimeout(() => {
        document.getElementById('mensajeTarea').innerText = "";
      }, 2000);
    }

    function mostrarTareas() {
      let key = `${anioActual}-${mesActual + 1}-${diaSeleccionado}`;
      let contenedor = document.getElementById('listaTareas');
      contenedor.innerHTML = "";

      if (tareas[key]) {
        tareas[key].forEach((t, i) => {
          let div = document.createElement('div');
          div.className = "tarea-item";
          div.innerHTML = `${t} <button onclick="eliminarTarea('${key}', ${i})">X</button>`;
          contenedor.appendChild(div);
        });
      }
    }

    function eliminarTarea(fecha, index) {
      tareas[fecha].splice(index, 1);
guardarEnLocalStorage();

      mostrarTareas();
      generateCalendar(anioActual, mesActual);
    }

    function cargarSelectorFecha() {
      let mesSelect = document.getElementById("mes");
      let anioSelect = document.getElementById("anio");

      const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                     'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

      for (let i = 0; i < 12; i++) {
        let opt = document.createElement("option");
        opt.value = i;
        opt.text = meses[i];
        if (i === mesActual) opt.selected = true;
        mesSelect.add(opt);
      }

      for (let i = anioActual - 5; i <= anioActual + 5; i++) {
        let opt = document.createElement("option");
        opt.value = i;
        opt.text = i;
        if (i === anioActual) opt.selected = true;
        anioSelect.add(opt);
      }
    }

    function cambiarMes() {
      let mes = parseInt(document.getElementById("mes").value);
      let anio = parseInt(document.getElementById("anio").value);
      mesActual = mes;
      anioActual = anio;
      diaSeleccionado = null;
      generateCalendar(anioActual, mesActual);
      document.getElementById("listaTareas").innerHTML = "";
    }

    function volverMesActual() {
      let hoy = new Date();
      mesActual = hoy.getMonth();
      anioActual = hoy.getFullYear();
      diaSeleccionado = null;

      document.getElementById("mes").value = mesActual;
      document.getElementById("anio").value = anioActual;
      generateCalendar(anioActual, mesActual);
      document.getElementById("listaTareas").innerHTML = "";
    }

    window.onload = function () {
      cargarSelectorFecha();
      generateCalendar(anioActual, mesActual);
    };
  </script>
</body>
</html>
